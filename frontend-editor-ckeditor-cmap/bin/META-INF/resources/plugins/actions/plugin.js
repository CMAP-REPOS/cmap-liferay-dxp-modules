
if(CKEDITOR.plugins.get('actions')){
	// ignore if the plugin is already registered 
} else {
  CKEDITOR.dialog.add( 'actions', '/o/custom-ckeditor/plugins/actions/dialogs/actions.js' );

  CKEDITOR.plugins.add( 'actions', {
    requires: 'widget',
    init: function( editor ) {

      editor.ui.addButton( 'Actions', {
        label: 'Add new action item',
        command: 'actions',
        toolbar: 'insert,1',
        icon: '/o/custom-ckeditor/plugins/actions/icons/actions.png',
        iconHiDpi: '/o/custom-ckeditor/plugins/actions/icons/actions@2x.png'
      });

      // https://docs.ckeditor.com/ckeditor4/latest/api/CKEDITOR_plugins_widget_definition.html
      editor.widgets.add( 'action', {

        template:
        '<div class="actions-row row">' +
          '<div class="col-sm-10">' +
            '<div class="mobile-headline whitney-normal bold alt-color">Action</div>' +
            '<p>Plan for infrastructure needs of the whole community through a capital improvement plan, including an assessment of the long-term maintenance costs generated by existing and planned developments</p>' +
          '</div>' +
          '<div class="mobile-hr col-sm-16">' +
            '<hr/>' +
          '</div>' +
          '<div class="col-sm-6">' +
            '<div class="mobile-headline whitney-normal bold alt-color">Implementers</div>' +
            '<p>Local governments</p>' +
          '</div>' +
          '<div class="col-sm-16">' +
            '<hr/>' +
          '</div>' +
        '</div>',

        editables: {
          action: {
            selector: '.col-sm-10'
          },
          implementor: {
            selector: '.col-sm-6'
          }
        },

        upcast: function( element, data ) {
          return element.name == 'div' && element.hasClass( 'actions-row' );
        },
      });

      editor.widgets.add( 'actions', {
        dialog: 'actions',

        template:
        '<div class="onto2050-actions">' +
          '<header class="actions-header row">' +
            '<div class="col-sm-10">' +
              '<div class="whitney-normal bold alt-color">Action</div>' +
            '</div>' +
            '<div class="col-sm-6">' +
              '<div class="whitney-normal bold alt-color">Implementers</div>' +
            '</div>' +
            '<div class="col-sm-16">' +
              '<hr/>' +
            '</div>' +
          '</header>' +
        '</div>',

        init: function(){
          console.log('init', CKEDITOR, this.isReady());
        },

        data: function() {
          console.log('data has changed', this.data.count);
        },
      });
    }
  });
}